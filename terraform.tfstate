{"version":4,"terraform_version":"1.10.6","serial":12,"lineage":"632aab47-e465-7ec9-b208-755f0cb70545","outputs":{"database_url":{"value":"postgresql://postgres:changeme@localhost:5434/velpdevdb","type":"string","sensitive":true},"next_steps":{"value":"\nYour infrastructure is ready! Next steps:\n\n1. Start the database:\n   docker-compose up -d\n\n2. Check it's running:\n   docker-compose ps\n\n3. View logs:\n   docker-compose logs postgres\n\n4. Connect from your backend using:\n   postgresql://postgres:changeme@localhost:5434/velpdevdb\n","type":"string","sensitive":true}},"resources":[{"mode":"managed","type":"local_file","name":"env_file","provider":"provider[\"registry.opentofu.org/hashicorp/local\"]","instances":[{"schema_version":0,"attributes":{"content":"# VelPharma Environment Configuration\n# Generated by OpenTofu\n\n# Database Configuration\nPOSTGRES_DB=velpdevdb\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=changeme\nPOSTGRES_PORT=5434\n\n# Project Configuration\nPROJECT_NAME=velpharma\nENVIRONMENT=dev\n\n# Database Connection String for Backend\nDATABASE_URL=postgresql://postgres:changeme@localhost:5434/velpdevdb\n","content_base64":null,"content_base64sha256":"FL1eX5cgqqIGDX5ymNNyqeJljbRgb4WCzZZtj1Ief+Y=","content_base64sha512":"55uPRwZl5nqg0tyhkVDkxU5iY90tKw/17h9epmgSd75TEVhZlqmj41oiL7iwMDCqcONgBv1WepFbI5Y6GmViYg==","content_md5":"3d19d15fec8cda27c69873fb1b20bf76","content_sha1":"c02e0a14b505c7ddd94c568a5ad584b157e639f3","content_sha256":"14bd5e5f9720aaa2060d7e7298d372a9e2658db4606f8582cd966d8f521e7fe6","content_sha512":"e79b8f470665e67aa0d2dca19150e4c54e6263dd2d2b0ff5ee1f5ea6681277be5311585996a9a3e35a222fb8b03030aa70e36006fd567a915b23963a1a656262","directory_permission":"0777","file_permission":"0644","filename":"./.env","id":"c02e0a14b505c7ddd94c568a5ad584b157e639f3","sensitive_content":null,"source":null},"sensitive_attributes":[[{"type":"get_attr","value":"sensitive_content"}],[{"type":"get_attr","value":"content"}]]}]},{"mode":"managed","type":"local_file","name":"readme","provider":"provider[\"registry.opentofu.org/hashicorp/local\"]","instances":[{"schema_version":0,"attributes":{"content":"# VelPharma Infrastructure\n\n## Overview\nThis project manages the VelPharma infrastructure using OpenTofu and Docker.\n\n## Structure\n```\n.\n├── postgres/           # PostgreSQL database\n│   ├── Dockerfile\n│   └── init/          # Database initialization scripts\n│       ├── 01-create-user.sql\n│       ├── 02-create-schema.sql\n│       └── 03-create-extensions.sql\n├── backups/           # Database backup directory\n├── reset-db.sh        # Script to rebuild database with fresh schema\n├── docker-compose.yml # Service orchestration (postgres + pgadmin)\n├── main.tf            # OpenTofu main configuration\n├── variables.tf       # Configuration variables\n└── .env               # Environment configuration (generated by OpenTofu)\n```\n\n## Getting Started\n\n### Prerequisites\n- Docker Desktop for Mac\n- OpenTofu CLI\n\n### Initial Setup\n1. Initialize OpenTofu:\n   ```bash\n   tofu init\n   ```\n\n2. Apply configuration (generates .env and this README):\n   ```bash\n   tofu apply\n   ```\n\n3. Start the services:\n   ```bash\n   docker-compose up -d\n   ```\n\n4. Check services are running:\n   ```bash\n   docker-compose ps\n   docker-compose logs -f\n   ```\n\n### Development Workflow\n\n**When you change init scripts and want a clean slate:**\n```bash\n./reset-db.sh\n```\n\n**For normal development (keeps existing data):**\n```bash\ndocker-compose up -d\n```\n\n### Services\n\n#### PostgreSQL Database\n- **Host:** localhost\n- **Port:** 5434 (external) / 5432 (internal Docker network)\n- **Database:** velpdevdb\n- **User:** postgres\n- **Password:** changeme\n- **Schema:** vpv4\n\nConnection string for external applications:\n```\npostgresql://postgres:changeme@localhost:5434/velpdevdb\n```\n\nConnection string for Docker services:\n```\npostgresql://postgres:changeme@postgres:5432/velpdevdb\n```\n\n#### PgAdmin (Database Management UI)\n- **URL:** http://localhost:5050\n- **Email:** admin@velpharma.com\n- **Password:** admin\n\n**To connect PgAdmin to database:**\n- Host: `postgres`, Port: `5432`, Database: `velpdevdb`, User: `postgres`, Password: `changeme`\n\n### Database Schema (vpv4)\n\n**Core:** ATC_CODES, ACTIVE_SUBSTANCES, PRODUCTS, MANUFACTURERS\n**ADRs:** ADVERSE_DRUG_REACTIONS, SYNONYMS, FREQUENCIES, ORGANS, SPECIALTIES, PARA_CLINICS\n**Deprescribing:** DEPRESCRIBING_GUIDELINES, DEPRESCRIBING_CONDITIONS\n**Staging:** IMPORT_STAGING_PRODUCTS_SUBSTANCES\n\n### Useful Commands\n```bash\n# Start/stop services\ndocker-compose up -d\ndocker-compose down\ndocker-compose down -v              # Remove volumes (deletes data!)\n\n# Logs\ndocker-compose logs -f\ndocker-compose logs -f postgres\n\n# Database access\ndocker-compose exec postgres psql -U postgres -d velpdevdb\n\n# Backup/restore\ndocker-compose exec postgres pg_dump -U postgres velpdevdb \u003e backups/backup.sql\ndocker-compose exec -T postgres psql -U postgres velpdevdb \u003c backups/backup.sql\n\n# Reset database (deletes all data!)\n./reset-db.sh\n```\n\n### Troubleshooting\n- **Init scripts not running?** Use `./reset-db.sh` to force re-initialization\n- **Port conflict?** Check with `lsof -i :5434`\n- **PgAdmin can't connect?** Use host `postgres` (not `localhost`) and port `5432` (not `5434`)\n\n## Configuration\nEdit `variables.tf` and run `tofu apply` to regenerate `.env` and this README.\n\n## Future Plans\n- [ ] Add backend service container\n- [ ] Add frontend service container\n- [ ] Automated database migrations\n- [ ] Kubernetes deployment\n- [ ] CI/CD pipeline\n","content_base64":null,"content_base64sha256":"8r+m3Udrq1ELz5msN5/a1VU6xY4cDvWhtbdxjNQiaxU=","content_base64sha512":"GTSCjybV0DjVzeX4znNvxlwKKFbXSk0aikV9X1scyvalSUMEibdB1GgkWlsJIMsZM+s1ToNghdZNDuRrKM36PQ==","content_md5":"554e4c0795a5ee7bf80f3f091e545d75","content_sha1":"79d32d264d16050ac9feb00c2d1eaf733969cccf","content_sha256":"f2bfa6dd476bab510bcf99ac379fdad5553ac58e1c0ef5a1b5b7718cd4226b15","content_sha512":"1934828f26d5d038d5cde5f8ce736fc65c0a2856d74a4d1a8a457d5f5b1ccaf6a549430489b741d468245a5b0920cb1933eb354e836085d64d0ee46b28cdfa3d","directory_permission":"0777","file_permission":"0644","filename":"./README.md","id":"79d32d264d16050ac9feb00c2d1eaf733969cccf","sensitive_content":null,"source":null},"sensitive_attributes":[[{"type":"get_attr","value":"content"}],[{"type":"get_attr","value":"sensitive_content"}]]}]}],"check_results":null}
